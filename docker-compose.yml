version: "3.8"

services:
  simulator:
    build: .
    ports:
      - "8765:8765"
    volumes:
      - ./config:/app/config
      - ./geodata:/app/geodata
    environment:
      - SCENARIO=${SCENARIO:-config/scenarios/demo_combined.yaml}
      - SIM_SPEED=${SIM_SPEED:-1}
    command: python -m scripts.run_simulator --scenario ${SCENARIO:-config/scenarios/demo_combined.yaml} --speed ${SIM_SPEED:-1}

  cop:
    build:
      context: ./cop
      args:
        - VITE_CESIUM_ION_TOKEN=${CESIUM_ION_TOKEN:-}
        - VITE_WS_URL=${WS_URL:-ws://localhost:8765}
    ports:
      - "3000:3000"
    depends_on:
      - simulator

  freetakserver:
    image: freetakteam/freetakserver:latest
    ports:
      - "8087:8087"
      - "8443:8443"
      - "19023:19023"
    profiles:
      - tak
